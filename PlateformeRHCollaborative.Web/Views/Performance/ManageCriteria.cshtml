@model IEnumerable<PlateformeRHCollaborative.Web.Models.EvaluationCriteria>

@{
    ViewData["Title"] = "Configuration des Critères";
}

<div class="container mt-4">
    <div class="az-content-breadcrumb">
        <span>Administration</span>
        <span>Performances</span>
        <span>Configuration Critères</span>
    </div>
    
    <div class="d-flex justify-content-between align-items-center mt-3 mb-4">
        <h2 class="az-content-title">Paramétrage des Critères d'Évaluation</h2>
    </div>

    <div class="alert alert-info shadow-sm border-0" style="border-radius: 12px;">
        <i class="fas fa-info-circle mr-2"></i>
        <strong>Note :</strong> La somme des poids doit idéalement être égale à 100% pour une cohérence du score final.
    </div>

    <div class="card border-0 shadow-sm">
        <div class="card-body p-4">
            <form asp-action="UpdateCriteria" method="post">
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="bg-light">
                            <tr>
                                <th style="width: 300px;">Nom du Critère</th>
                                <th>Poids (%)</th>
                                <th class="text-center">Aperçu Impact</th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                var criteriaList = Model.ToList();
                                for (int i = 0; i < criteriaList.Count; i++)
                                {
                                    <tr>
                                        <td>
                                            <input type="hidden" name="criteria[@i].Id" value="@criteriaList[i].Id" />
                                            <input type="text" name="criteria[@i].Name" class="form-control font-weight-bold" value="@criteriaList[i].Name" />
                                            <small class="text-muted d-block mt-1">@criteriaList[i].Description</small>
                                        </td>
                                        <td>
                                            <div class="input-group" style="width: 120px;">
                                                <input type="number" name="criteria[@i].Weight" class="form-control criteria-weight" 
                                                       value="@criteriaList[i].Weight" step="1" min="0" max="100" />
                                                <div class="input-group-append">
                                                    <span class="input-group-text">%</span>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="text-center">
                                            <div class="progress" style="height: 20px; border-radius: 10px;">
                                                <div class="progress-bar bg-primary" role="progressbar" 
                                                     style="width: @criteriaList[i].Weight%" 
                                                     aria-valuenow="@criteriaList[i].Weight" aria-valuemin="0" aria-valuemax="100">
                                                    @criteriaList[i].Weight%
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            }
                        </tbody>
                        <tfoot class="bg-light font-weight-bold">
                            <tr>
                                <td class="text-right">Total :</td>
                                <td colspan="2">
                                    <span id="totalWeight" class="h5 mb-0">@Model.Sum(c => c.Weight)%</span>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <div class="mt-4 d-flex justify-content-end">
                    <button type="submit" class="btn btn-primary btn-lg px-5 shadow">
                        <i class="fas fa-save mr-2"></i> Enregistrer les modifications
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).on('input', '.criteria-weight', function() {
            let total = 0;
            $('.criteria-weight').each(function() {
                total += parseFloat($(this).val()) || 0;
            });
            $('#totalWeight').text(total + '%');
            
            if (total !== 100) {
                $('#totalWeight').addClass('text-danger').removeClass('text-success');
            } else {
                $('#totalWeight').addClass('text-success').removeClass('text-danger');
            }

            // Update individual progress bars
            $(this).closest('tr').find('.progress-bar').css('width', $(this).val() + '%').text($(this).val() + '%');
        });
    </script>
}
